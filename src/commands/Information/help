const { EmbedBuilder, ActionRowBuilder, ButtonBuilder} = require("discord.js");
const {readdirSync} = require("fs");
const db = require("quick.db");

module.exports = {
    name: "help",
    category: "Information",
    aliases: [ "h" ],
    description: "Xem danh sách và chi tiết lệnh",
    args: false,
    usage: "[command name]",
    permission: [],
    owner: false,
    execute: async (message, args, client, prefix) => {
        const row = new ActionRowBuilder()
    .addComponents(
    new ButtonBuilder()
  .setLabel("Support Server")
  .setStyle("LINK")
  .setEmoji('889965765057466418')
  .setURL(`https://discord.gg/UEAgEm8YFq`),
  
  new ButtonBuilder()
  .setLabel("Invite Me")
  .setStyle("LINK")
  .setEmoji('926363015689945148')
  .setURL(`https://discord.com/api/oauth2/authorize?client_id=${client.user.id}&PermissionsBitField=36785216&scope=bot%20applications.commands`),
  );
      const embed = new EmbedBuilder()
      .setTitle(`${client.user.username} Commands`)
      .setColor(client.embedColor)
      .setThumbnail(client.user.displayAvatarURL())
      if (!args[0]) {
          const categories = readdirSync('src/commands/');
          let commandsize = 0;
          categories.forEach(category => {
              const dir = client.commands.filter(c => c.category === category);
              commandsize += parseInt(dir.size);
              const capitalise = category.slice(0, 1).toUpperCase() + category.slice(1);
              try {
                  embed.addField(`❯ ${capitalise} - [${dir.size} lệnh]:`, dir.map(c => `  \`${c.name}\``).join(' '));
              } catch(e) {
                  console.log(e);
              }
          });
          embed
              .setFooter(`${client.lang.use} ${prefix}${client.lang.cmd.useHelp}`)
              .setDescription(`>>> Prefix : \`${prefix}\`\nTổng số lệnh: ${commandsize}`)
          return message.channel.send({ embeds: [embed], components: [row]});
      } else return getCMD(message, args, client, prefix);
    }
  }
  
  //Xem chi tiết lệnh hoặc danh sách lệnh
  function getCMD(message, args, client, prefix) {
    let language = db.get(`${message.guild.id}.lang`);
  
    const command = client.commands.get(args[0].toLowerCase()) ||client.commands.find(
      (c) => c.aliases && c.aliases.includes(args[0].toLowerCase()));
     
     const c = `Không có lệnh \`${args[0]}\``
     
    if (!command) {
      const embed = new EmbedBuilder()
        .setDescription(`${c}\nSử dụng \`${prefix}help\` để xem danh sách lệnh!`)
        .setColor("#ED1616");
        return message.channel.send({ embeds: [embed]});
    }
              const emb = new EmbedBuilder() 
                  .setTitle(`Chi tiết lệnh:`)
                  .addField(
                      `Tên lệnh:`,
                      command.name ? `\`${command.name}\`` : `Không có!`
                  )
                  .addField(
                    `Lệnh khác:`,
                      command.aliases ?
                      `\`${command.aliases.join("` `")}\`` :
                      `Không có!`
                  )
                  .addField(
                    `Sử dụng`,
                      command.usage ?
                      `\`${prefix}${command.name} ${command.usage}\`` :
                      `\`${prefix}${command.name}\``
                  )
                  .addField(
                    `Mô tả:`,
                      command.description ? command.description : "Không có mô tả."
                  )
                  .setFooter(
                      `<> - bắt buộc, [] - không bắt buộc`,   
                  )
                  .setColor("Green");
              return message.channel.send({ embeds: [emb]});
  }